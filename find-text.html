<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>.txt Locator — Law Tools</title>
<style>
  body{margin:0;font:14px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;background:#f6f8fb;color:#0b2239}
  header{background:#0b2239;color:#fff;padding:14px 16px}
  header a{color:#fff;text-decoration:none;opacity:.8}
  main{max-width:1100px;margin:18px auto;padding:0 12px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  input,select,button{font:inherit}
  input[type="text"]{padding:8px 10px;border:1px solid #d0d7de;border-radius:8px;min-width:260px;background:#fff}
  button{background:#0d6efd;color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  table{width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.07)}
  th,td{padding:10px;border-bottom:1px solid #eef2f6;vertical-align:top}
  th{background:#f3f6fb;text-align:left;font-weight:600}
  tr:hover td{background:#fafcff}
  .muted{color:#5b6b7b}
  code{background:#f3f6fb;padding:2px 6px;border-radius:6px}
  .badge{display:inline-block;padding:2px 6px;border-radius:6px;font-size:12px;margin-right:6px;background:#eef6ff;color:#0d6efd}
  .pill{display:inline-block;padding:2px 6px;border-radius:999px;font-size:12px;background:#e9f5ee;color:#267a4a}
  .danger{background:#fde8e8;color:#b42318}
  .right{float:right}
</style>
</head>
<body>
<header>
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <div><strong>.txt Locator</strong> — find normalized text files across repos</div>
    <div><a href="./index.html">← Back to tools</a></div>
  </div>
</header>
<main>
  <div class="controls">
    <input id="filter" type="text" placeholder="Filter by filename… (e.g., lewin, birks, jersey)">
    <button id="scanBtn">Scan now</button>
    <span class="muted" id="status"></span>
  </div>

  <table id="results">
    <thead>
      <tr>
        <th>File</th>
        <th>Repo / Path</th>
        <th>Jurisdiction</th>
        <th>Size</th>
        <th>Open</th>
        <th>Canonical destination</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p class="muted" style="margin-top:12px">
    Canonical textbook location is <code>Law-Texts-ui/data/textbooks/&lt;jersey|uk&gt;/&lt;filename&gt;.txt</code>.
    Use GitHub’s “Move” to place files exactly there so the search UI and catalogs pick them up.
  </p>
</main>

<script>
const OWNER = 'Info1691';

// Directories we care about (add/remove as needed)
const TARGETS = [
  { repo: 'Law-Texts-ui', path: 'data/textbooks/jersey', label:'Textbooks / Jersey' },
  { repo: 'Law-Texts-ui', path: 'data/textbooks/uk',     label:'Textbooks / UK'     },
  { repo: 'lex-ingest-local', path: 'law-index/texts/jersey', label:'Ingester / Jersey' },
  { repo: 'lex-ingest-local', path: 'law-index/texts/uk',     label:'Ingester / UK'     },
  // optional: shows if sources still sit here (PDFs etc.)
  { repo: 'lex-ingest-local', path: 'source/jersey', label:'Source / Jersey' },
  { repo: 'lex-ingest-local', path: 'source/uk',     label:'Source / UK' },
];

const apiRoot = 'https://api.github.com';

async function ghJSON(url){
  const r = await fetch(url, { headers: { 'Accept':'application/vnd.github+json' }});
  if(!r.ok) throw new Error(`${r.status} ${r.statusText} – ${url}`);
  return r.json();
}

function prettySize(bytes){
  if(bytes == null) return '';
  const u = ['B','KB','MB','GB'];
  let i = 0, n = bytes;
  while(n >= 1024 && i < u.length-1){ n/=1024; i++; }
  return `${n.toFixed(n>=10||i===0?0:1)} ${u[i]}`;
}

function guessJurisdiction(path){
  return /\/jersey(\/|$)/i.test(path) ? 'jersey'
       : /\/uk(\/|$)/i.test(path)     ? 'uk'
       : '';
}

function canonicalDest(name, jurisdiction){
  if(!jurisdiction) jurisdiction = '';
  return `Law-Texts-ui/data/textbooks/${jurisdiction}/${name}`;
}

function ghLinks(owner, repo, path){
  const enc = path.split('/').map(encodeURIComponent).join('/');
  const web = `https://github.com/${owner}/${repo}/blob/main/${enc}`;
  const raw = `https://raw.githubusercontent.com/${owner}/${repo}/main/${enc}`;
  return { web, raw };
}

async function listTxt(owner, repo, path){
  const url = `${apiRoot}/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=main&per_page=100`;
  try{
    const arr = await ghJSON(url);
    if(!Array.isArray(arr)) return [];
    return arr.filter(x => x && x.type === 'file' && /\.txt$/i.test(x.name))
              .map(x => ({ name:x.name, size:x.size, path:`${path}/${x.name}` }));
  }catch(e){
    console.warn('List error:', e.message);
    return []; // silently continue; path may not exist
  }
}

async function scan(){
  const status = document.getElementById('status');
  status.textContent = 'Scanning GitHub…';
  const rows = [];
  for(const t of TARGETS){
    const files = await listTxt(OWNER, t.repo, t.path);
    for(const f of files){
      const jur = guessJurisdiction(f.path);
      const dest = canonicalDest(f.name, jur);
      const links = ghLinks(OWNER, t.repo, f.path);
      rows.push({
        file: f.name,
        repo: t.repo,
        path: f.path,
        size: f.size,
        jur,
        web: links.web,
        raw: links.raw,
        dest
      });
    }
  }
  render(rows);
  status.textContent = `Found ${rows.length} .txt file(s)`;
}

function render(rows){
  const filter = (document.getElementById('filter').value || '').toLowerCase().trim();
  const tbody = document.querySelector('#results tbody');
  tbody.innerHTML = '';
  for(const r of rows){
    if(filter && !(r.file.toLowerCase().includes(filter) ||
                   r.path.toLowerCase().includes(filter) ||
                   r.repo.toLowerCase().includes(filter) ||
                   r.jur.toLowerCase().includes(filter))) continue;

    const tr = document.createElement('tr');

    const tdFile = document.createElement('td');
    tdFile.innerHTML = `<span class="badge">.txt</span> <strong>${r.file}</strong>`;
    tr.appendChild(tdFile);

    const tdRepo = document.createElement('td');
    tdRepo.innerHTML = `<code>${r.repo}</code><div class="muted">${r.path}</div>`;
    tr.appendChild(tdRepo);

    const tdJur = document.createElement('td');
    tdJur.innerHTML = r.jur ? `<span class="pill">${r.jur}</span>` : '<span class="danger">unknown</span>';
    tr.appendChild(tdJur);

    const tdSize = document.createElement('td');
    tdSize.textContent = prettySize(r.size);
    tr.appendChild(tdSize);

    const tdOpen = document.createElement('td');
    tdOpen.innerHTML = `<a href="${r.web}" target="_blank">GitHub</a> · <a href="${r.raw}" target="_blank">RAW</a>`;
    tr.appendChild(tdOpen);

    const tdDest = document.createElement('td');
    tdDest.innerHTML = `<code>${r.dest}</code>`;
    tr.appendChild(tdDest);

    tbody.appendChild(tr);
  }
}

document.getElementById('scanBtn').addEventListener('click', scan);
document.getElementById('filter').addEventListener('input', () => scan());
window.addEventListener('load', scan);
</script>
</body>
</html>
